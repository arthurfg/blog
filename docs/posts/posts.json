[
  {
    "path": "posts/2022-02-19-case-base-dos-dados/",
    "title": "Case Base dos Dados",
    "description": {},
    "author": [
      {
        "name": "Arthur Gusmão",
        "url": "https://github.com/arthurfg"
      }
    ],
    "date": "2022-02-19",
    "categories": [],
    "contents": "\r\nArthur Gusmão\r\nO BD Case:\r\nElaborar uma visualização, usando pelo menos uma das seguintes bases:\r\nEleições Brasileiras.\r\nSistema de Informações Contábeis e Fiscais do Setor Público Brasileiro (Siconfi).\r\nInflação.\r\nA base escolhida foi a de Eleições Brasileiras.\r\n\r\n\r\nEntão vamos nessa! Importando os pacotes:\r\n\r\n\r\nlibrary(basedosdados)\r\nlibrary(tidyverse)\r\nlibrary(geofacet)\r\nlibrary(ggh4x)\r\nlibrary(plotly)\r\nlibrary(extrafont)\r\n\r\n\r\n\r\nO objetivo da minha análise é visualizar a evolução no tempo do número de vereadoras eleitas e compará-lo com o número de vereadores eleitos, para todas as Unidades Federativas do Brasil. Para isso, usei a base de eleições (do TSE), disponibilizada no datalake. De maneira resumida, carreguei as bases com os resultados e fiz um merge() com a base dos candidatos, que é a que contêm os dados de gênero, raça, instrução e etc.\r\nBaixando os dados do datalake com a função basedosdados::bdplyr() e construindo a query com o dplyr:\r\n\r\n\r\nset_billing_id(\"casebd\")\r\n\r\n## base de resultados\r\nquery <- bdplyr(\"br_tse_eleicoes.resultados_candidato\") %>%\r\n  select(ano, id_municipio, sigla_uf,\r\n         turno, tipo_eleicao, cargo,\r\n         numero_candidato, id_candidato_bd,\r\n         resultado, ano)%>%\r\n  filter(ano > 2007,cargo == \"vereador\", resultado != \"nao eleito\")\r\n\r\ndf_resultado <- bd_collect(query)\r\n\r\n\r\n## base de candidatos\r\n\r\nquery2 <- bdplyr(\"br_tse_eleicoes.candidatos\") %>%\r\n  select(ano,sigla_uf,id_candidato_bd,nome,situacao,ocupacao, genero, idade,instrucao,raca)%>%\r\n  filter(ano > 2007)\r\n\r\ndf_candidatos <- bd_collect(query2)\r\n\r\n#query3 <- bdplyr(\"br_me_siconfi.municipio_despesas_funcao\")%>%\r\n  #filter(sigla_uf == \"RJ\", ano >2012)\r\n\r\n#df_despesas <- bd_collect(query3)\r\n\r\nquery4 <- bdplyr(\"br_bd_diretorios_brasil.uf\")%>%\r\n  select(sigla, nome)\r\n\r\ndiretorio <- bd_collect(query4)\r\n\r\n\r\n\r\nComo disse, fiz o merge() das bases de candidatos e do resultado das eleições, e também fiz um merge() com a base de diretórios, para facilitar a visualização dos nomes das UF’s.\r\n\r\n\r\ncandidatos_merged <- merge(df_candidatos, df_resultado, by = c(\"id_candidato_bd\",\"ano\"))\r\n\r\ndiretorio <- diretorio %>%\r\n  rename(nome_uf = nome, sigla_uf = sigla) #%>%\r\n\r\ncandidatos_merged <- merge(candidatos_merged, diretorio, by.x = \"sigla_uf.x\", by.y = \"sigla_uf\")\r\n\r\n#df_despesas %>%\r\n  #filter(estagio == \"Despesas Pagas\") %>% group_by(conta) %>% distinct(conta) %>% view()\r\n\r\n\r\n\r\nCom as funções do dplyr, montei uma base (a) com número de candidatos(as) eleitos(as), por gênero, e a propoção entre os dois gêneros.\r\n\r\n\r\na <- candidatos_merged %>%\r\n  filter(resultado != \"suplente\")%>%\r\n  filter(tipo_eleicao == \"eleicao ordinaria\", situacao == \"deferido\")%>%\r\n  #mutate(militar = case_when(str_detect(ocupacao,c(\"policia|militar reformado\"))~ \"Policial ou Militar\",TRUE ~ \"Outras ocupações\"))%>% ##tinha pensado em fazer algo relacionado à policia, mas desisti...\r\n  group_by(ano, sigla_uf.x, genero)%>%\r\n  summarise(N = n()) %>%\r\n  group_by(ano, sigla_uf.x)%>%\r\n  mutate(total = sum(N), proporcao =round(N/total,2))%>%\r\n  mutate(genero = if_else(is.na(genero), \"nao respondido\", genero))%>%\r\n  mutate(genero = as.factor(genero)) \r\n\r\n\r\n\r\nCom a base pronta, criei uma primeira visualização, com o pacote ggplot2, mostrando a evolução temporal da proporção de pessoas eleitas, para o cargo de vereador(a), do gênero feminino, comparada com o total de vereadores(as) eleitos(as), por UF. Com o geofacet::facet_geo() pude deixar a visualização um pouquinho mais “bonita”, dando ao gráfico o formato, não tão exato, do mapa do Brasil.\r\n\r\n\r\na %>%\r\n  filter(genero==\"feminino\")%>%\r\n  ggplot(aes(x = ano, y = proporcao))+\r\n  geom_area(fill = \"#009688\",alpha=0.4) +\r\n  geom_line(color=\"#762a83\", size=1, alpha = 0.5) +\r\n  geom_point(size=1.5, color=\"#762a83\", alpha = 0.5)+\r\n  scale_y_continuous(labels = scales::percent)+\r\n  facet_geo(~sigla_uf.x, grid = \"br_states_grid1\")+\r\n  scale_x_continuous(breaks = seq(2008, 2020, 4)) +\r\n  labs(\r\n    title = \"Percentual de\\nvereadoras(es) do gênero\\nfeminino eleitas(os),\\n2008-2020:\",\r\n    caption = \"Fonte: @basedosdados · Elaboração: Arthur Gusmão\\nObs: Não há eleições municipais no Distrito Federal\"\r\n  ) +\r\n  theme_minimal() +\r\n  theme(\r\n    panel.grid = element_blank(),\r\n    legend.pos = c(0.875, 0.975),\r\n    legend.direction = \"horizontal\",\r\n    legend.box = \"vertical\",\r\n    legend.title = element_blank(),\r\n    plot.background = element_rect(fill = \"#F5F4EF\", color = NA),\r\n    plot.margin = margin(40, 60, 40, 60),\r\n    plot.title = element_text(\r\n      margin = margin(0, 0, 0, 0), \r\n      size = 20,\r\n      family = \"Georgia\",\r\n      face = \"bold\",\r\n      vjust = 0, \r\n      color = \"grey25\"\r\n    ),\r\n    plot.caption = element_text(size = 11, family = \"Georgia\", color = \"grey25\"),\r\n    axis.title = element_blank(),\r\n    axis.text.x = element_text(color = \"grey40\", size = 8),\r\n    axis.text.y = element_text(color = \"grey40\", size = 6),\r\n    strip.text = element_text(face = \"bold\", color = \"grey20\")\r\n    \r\n  )\r\n\r\n\r\n\r\n\r\nAgora outra visualização:\r\n\r\n\r\n## Pegando as UF's que tiveram resultado positivo na comparação 2008-2020\r\na %>%\r\n  filter(genero == \"feminino\", ano == 2008 | ano ==2020) %>%\r\n  mutate(sigla_uf.x = factor(sigla_uf.x, levels = sigla_uf.x))%>%\r\n  group_by(sigla_uf.x)%>%\r\n  mutate(pct_change = (proporcao/lag(proporcao) - 1))%>% \r\n  mutate(pct_change = coalesce(pct_change,0))%>%\r\n  mutate(id = case_when(pct_change > 0  ~ \"positivo\",\r\n                        TRUE ~\"negativo\"))%>%\r\n  filter(id == \"positivo\")%>%\r\n  pull(sigla_uf.x) -> positivos\r\n\r\n\r\n## Base com os resultados positivos, irá ficar mais ressaltada no grafico:\r\n### Dica do https://uc-r.github.io/cleveland-dot-plots\r\nhighlight <- a %>%\r\n  filter(genero == \"feminino\", ano == 2008 | ano ==2020) %>%\r\n  group_by(ano)%>%\r\n  arrange(proporcao)%>%\r\n  mutate(sigla_uf.x = factor(sigla_uf.x, levels = sigla_uf.x))%>%\r\n  filter(sigla_uf.x %in% positivos)\r\n\r\n\r\n## Criando as bases com os labels\r\nlabel_esq <- a %>%\r\n  filter(genero == \"feminino\", ano == 2008) %>%\r\n  group_by(ano)%>%\r\n  arrange(proporcao)%>%\r\n  mutate(sigla_uf.x = factor(sigla_uf.x, levels = sigla_uf.x))%>%\r\n  filter(sigla_uf.x %in% positivos)\r\n\r\nlabel_dir <- a %>%\r\n  filter(genero == \"feminino\",ano ==2020) %>%\r\n  group_by(ano)%>%\r\n  arrange(proporcao)%>%\r\n  mutate(sigla_uf.x = factor(sigla_uf.x, levels = sigla_uf.x))%>%\r\n  filter(sigla_uf.x %in% positivos)\r\n\r\n## O gráfico:\r\nplot3 <- a %>%\r\n  filter(genero == \"feminino\", ano == 2008 | ano ==2020) %>%\r\n  group_by(ano)%>%\r\n  arrange(ano)%>%\r\n  mutate(sigla_uf.x = factor(sigla_uf.x, levels = sigla_uf.x))%>%\r\n  ggplot(aes(proporcao,sigla_uf.x))+\r\n  geom_line(aes(group = sigla_uf.x), alpha = 0.4)+\r\n  geom_line(data= highlight, aes(group = sigla_uf.x), size = 0.6)+\r\n  geom_point(aes(color = as.factor(ano)), alpha = 0.4, size= 1.5)+\r\n  geom_point(data = highlight, aes(color = as.factor(ano)), size = 3)+\r\n  geom_text(data = label_dir, aes(label= scales::percent(proporcao,accuracy = 0.1)), size = 2.5, hjust = -0.5)+\r\n  geom_text(data = label_esq, aes(label=  scales::percent(proporcao, accuracy = 0.1)), size = 2.5, hjust = 1.5)+\r\n  scale_x_continuous(labels = scales::percent)\r\n\r\n\r\n##  Ajustes finais:\r\nplot3 +\r\n  scale_color_manual(values=c(\"#009688\", \"#762a83\"))+\r\n  scale_y_discrete(expand = c(.02, 0)) +\r\n        labs(title = \"Percentual de vereadoras(es) do \\ngênero feminino eleitos(as), 2008-2020:\",\r\n             subtitle = \"Das 26 Unidades Federativas Brasileiras, 13 apresentaram crescimento da proporção de eleitos(as)\\ndo gênero feminino no período 2008-2020.\\nEssas 13 Unidades Federativas estão ressaltadas no gráfico.\",\r\n             caption = \"Fonte: @basedosdados · Elaboração: Arthur Gusmão\") +\r\n        theme_minimal() +\r\n        theme(axis.title = element_blank(),\r\n              plot.background = element_rect(fill = \"#F5F4EF\", color = NA),\r\n              panel.grid.major.x = element_blank(),\r\n              panel.grid.minor = element_blank(),\r\n              legend.title = element_blank(),\r\n              plot.margin = margin(10, 10, 10, 10),\r\n              legend.justification = c(0, 1), \r\n              legend.position = c(.1, 1.075),\r\n              legend.background = element_blank(),\r\n              legend.direction=\"horizontal\",\r\n              text = element_text(family = \"Georgia\"),\r\n              plot.title = element_text(size = 20, margin = margin(b = 10), color = \"grey25\", face = \"bold\"),\r\n              plot.subtitle = element_text(size = 10, color = \"grey20\", margin = margin(b = 25)),\r\n              plot.caption = element_text(size = 8, margin = margin(t = 10), color = \"grey25\", hjust = 0))\r\n\r\n\r\n\r\n\r\nÉ isso, espero que gostem :)\r\n\r\n\r\n\r\n",
    "preview": "posts/2022-02-19-case-base-dos-dados/case-base-dos-dados_files/figure-html5/unnamed-chunk-5-1.png",
    "last_modified": "2022-02-19T02:54:54-03:00",
    "input_file": "case-base-dos-dados.knit.md"
  },
  {
    "path": "posts/welcome/",
    "title": "Welcome to Arthur",
    "description": "Welcome to our new blog, Arthur. We hope you enjoy \nreading what we have to say!",
    "author": [
      {
        "name": "Nora Jones",
        "url": "https://example.com/norajones"
      }
    ],
    "date": "2022-02-19",
    "categories": [],
    "contents": "\r\n\r\n\r\n\r\n",
    "preview": {},
    "last_modified": "2022-02-19T01:59:43-03:00",
    "input_file": {}
  }
]
